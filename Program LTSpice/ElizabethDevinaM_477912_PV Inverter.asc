Version 4
SHEET 1 1888 1244
WIRE 144 0 -192 0
WIRE 288 0 144 0
WIRE 432 0 288 0
WIRE 144 16 144 0
WIRE 192 16 144 16
WIRE 240 16 224 16
WIRE 288 16 288 0
WIRE 336 16 288 16
WIRE 432 16 432 0
WIRE 480 16 432 16
WIRE 144 32 144 16
WIRE 192 32 192 16
WIRE 288 32 288 16
WIRE 336 32 336 16
WIRE 384 32 368 32
WIRE 432 32 432 16
WIRE 480 32 480 16
WIRE 96 48 64 48
WIRE 240 48 240 16
WIRE 384 48 384 32
WIRE -192 64 -192 0
WIRE 96 96 64 96
WIRE 192 112 192 96
WIRE 192 112 144 112
WIRE 240 112 240 96
WIRE 336 112 336 96
WIRE 336 112 288 112
WIRE 480 112 480 96
WIRE 480 112 432 112
WIRE 384 128 384 96
WIRE 144 144 144 112
WIRE 544 144 144 144
WIRE 576 144 544 144
WIRE 688 144 656 144
WIRE 976 144 768 144
WIRE 1408 144 1008 144
WIRE 1536 144 1408 144
WIRE 288 192 288 112
WIRE 544 192 288 192
WIRE 576 192 544 192
WIRE 688 192 656 192
WIRE 1040 192 768 192
WIRE 1408 192 1072 192
WIRE 1456 192 1408 192
WIRE -192 224 -192 144
WIRE 1104 224 784 224
WIRE 1344 224 1136 224
WIRE 1376 224 1344 224
WIRE 1456 224 1456 192
WIRE 1536 224 1536 144
WIRE 256 240 240 240
WIRE 384 240 368 240
WIRE 432 240 432 112
WIRE 544 240 432 240
WIRE 560 240 544 240
WIRE 144 256 144 144
WIRE 192 256 144 256
WIRE 288 256 288 192
WIRE 336 256 288 256
WIRE 432 256 432 240
WIRE 480 256 432 256
WIRE 560 256 560 240
WIRE 576 256 560 256
WIRE 688 256 656 256
WIRE 784 256 784 224
WIRE 784 256 768 256
WIRE 992 256 992 160
WIRE 1056 256 1056 208
WIRE 96 272 64 272
WIRE 240 272 240 240
WIRE 384 272 384 240
WIRE 1120 272 1120 240
WIRE 192 288 192 256
WIRE 336 288 336 256
WIRE 480 288 480 256
WIRE 96 336 96 320
WIRE 96 336 48 336
WIRE 224 336 224 256
WIRE 240 336 240 320
WIRE 240 336 224 336
WIRE 1376 336 1376 304
WIRE 1456 336 1456 304
WIRE 1536 336 1536 304
WIRE 144 352 144 336
WIRE 192 352 144 352
WIRE 288 352 288 336
WIRE 336 352 288 352
WIRE 432 352 432 336
WIRE 480 352 432 352
WIRE -192 368 -192 304
WIRE 144 368 144 352
WIRE 144 368 -192 368
WIRE 288 368 288 352
WIRE 288 368 144 368
WIRE 432 368 432 352
WIRE 432 368 288 368
WIRE 384 384 384 320
WIRE 384 384 352 384
WIRE 592 384 544 384
WIRE 784 384 656 384
WIRE 272 416 224 416
WIRE 400 416 272 416
WIRE 400 448 400 416
WIRE 928 448 896 448
WIRE 1056 448 1040 448
WIRE 544 464 544 384
WIRE 544 464 464 464
WIRE 784 464 784 384
WIRE 800 464 784 464
WIRE 1040 464 1040 448
WIRE 1040 464 992 464
WIRE 1152 464 1120 464
WIRE 1824 464 1792 464
WIRE 544 480 544 464
WIRE 592 480 544 480
WIRE 704 480 656 480
WIRE 896 480 896 448
WIRE 896 480 864 480
WIRE 1392 480 1376 480
WIRE 1632 480 1456 480
WIRE 768 496 768 480
WIRE 800 496 768 496
WIRE 1824 496 1792 496
WIRE 224 512 224 416
WIRE 1056 512 1056 480
WIRE 1152 512 1152 464
WIRE 1200 512 1152 512
WIRE 1344 512 1296 512
WIRE 928 544 928 480
WIRE 928 544 880 544
WIRE 1360 544 1296 544
WIRE 400 560 400 480
WIRE 400 560 336 560
WIRE 512 560 400 560
WIRE 912 560 576 560
WIRE 1200 560 1168 560
WIRE 1360 560 1360 544
WIRE 1392 560 1360 560
WIRE 1584 560 1456 560
WIRE 1376 576 1376 480
WIRE 1376 576 1296 576
WIRE 1824 576 1792 576
WIRE 1584 592 1584 560
WIRE 1632 592 1584 592
WIRE 1824 608 1792 608
WIRE -80 624 -144 624
WIRE 336 624 288 624
WIRE 464 624 336 624
WIRE 1248 624 1248 592
WIRE -80 640 -80 624
WIRE -64 640 -80 640
WIRE 1344 640 1344 512
WIRE 1392 640 1344 640
WIRE 1568 640 1456 640
WIRE -64 656 -144 656
WIRE 32 656 0 656
WIRE 384 656 224 656
WIRE 464 656 464 624
WIRE 512 656 464 656
WIRE 880 656 880 544
WIRE 880 656 576 656
WIRE -64 672 -96 672
WIRE 384 672 384 656
WIRE 912 672 912 560
WIRE 928 672 912 672
WIRE 1056 672 1056 624
WIRE -96 688 -96 672
WIRE -96 688 -144 688
WIRE 224 688 224 656
WIRE 480 688 448 688
WIRE 1040 688 992 688
WIRE 1168 688 1168 560
WIRE 1168 688 1120 688
WIRE 1840 688 1792 688
WIRE 336 704 336 624
WIRE 384 704 336 704
WIRE 1040 704 1040 688
WIRE 1056 704 1040 704
WIRE 1568 704 1568 640
WIRE 1632 704 1568 704
WIRE 560 720 496 720
WIRE 1840 720 1792 720
WIRE 560 736 560 720
WIRE 576 736 560 736
WIRE 784 736 640 736
WIRE 480 752 480 688
WIRE 496 752 496 720
WIRE 496 752 480 752
WIRE 144 768 112 768
WIRE 256 784 224 784
WIRE 144 800 112 800
WIRE 784 800 784 736
WIRE 256 816 224 816
WIRE 496 816 496 752
WIRE 576 816 496 816
WIRE 672 816 640 816
WIRE 928 816 928 704
WIRE 928 816 848 816
WIRE 144 832 112 832
WIRE 736 832 736 816
WIRE 784 832 736 832
WIRE 176 864 176 848
WIRE 144 944 112 944
WIRE 256 960 224 960
WIRE 144 976 112 976
WIRE 256 992 224 992
WIRE 144 1008 112 1008
WIRE 176 1040 176 1024
FLAG 64 96 g1
FLAG 240 112 g2
FLAG 384 128 g3
FLAG 224 656 iqref
FLAG 272 416 idref
FLAG 1056 512 vgd
FLAG 1056 624 vgq
FLAG 336 560 id
FLAG 288 624 iq
FLAG 544 144 vinv_a
FLAG 544 192 vinv_b
FLAG 544 240 vinv_c
FLAG 1152 464 vinv_d
FLAG 1168 688 vinv_q
FLAG 1248 624 teta
FLAG 112 944 vg_a
FLAG 112 976 vg_b
FLAG 112 1008 vg_c
FLAG 176 1040 teta
FLAG 256 992 vgq
FLAG 256 960 vgd
FLAG 112 768 ia
FLAG 112 800 ib
FLAG 112 832 ic
FLAG 176 864 teta
FLAG 256 816 iq
FLAG 256 784 id
FLAG 1376 336 0
FLAG 1456 336 0
FLAG 1536 336 0
FLAG 1408 144 vg_a
FLAG 1408 192 vg_b
FLAG 1344 224 vg_c
FLAG 992 256 ia
FLAG 1056 256 ib
FLAG 1120 272 ic
FLAG 48 336 g4
FLAG 224 256 g5
FLAG 352 384 g6
FLAG 1824 464 g1
FLAG 1824 496 g4
FLAG 1824 576 g2
FLAG 1824 608 g5
FLAG 1840 688 g3
FLAG 1840 720 g6
FLAG 64 48 0
FLAG 64 272 0
FLAG 256 240 0
FLAG 368 240 0
FLAG 224 16 0
FLAG 368 32 0
FLAG 32 656 teta
FLAG -144 624 vg_a
FLAG -144 656 vg_b
FLAG -144 688 vg_c
SYMBOL voltage -192 48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 200
SYMBOL voltage -192 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 200
SYMBOL res 672 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -2 55 VTop 2
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 672 176 R90
WINDOW 0 21 59 VBottom 2
WINDOW 3 17 61 VTop 2
SYMATTR InstName R2
SYMATTR Value 0.1
SYMBOL res 672 240 R90
WINDOW 0 24 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 0.1
SYMBOL ind 672 160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 32 53 VBottom 2
SYMATTR InstName L1
SYMATTR Value 5m
SYMBOL ind 672 208 R270
WINDOW 0 11 57 VTop 2
WINDOW 3 17 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value 5m
SYMBOL ind 672 272 R270
WINDOW 0 3 57 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value 5m
SYMBOL Substractor 432 464 R0
SYMATTR InstName X1
SYMBOL Substractor 416 688 R0
SYMATTR InstName X2
SYMBOL Substractor 960 464 R0
SYMATTR InstName X3
SYMBOL Adder 1088 464 R0
SYMATTR InstName X4
SYMBOL Adder 1088 688 R0
SYMATTR InstName X5
SYMBOL Adder 960 688 R0
SYMATTR InstName X6
SYMBOL Gain 1424 480 R0
SYMATTR InstName X7
SYMATTR SpiceLine K=1
SYMBOL Gain 1424 560 R0
SYMATTR InstName X8
SYMATTR SpiceLine K=1
SYMBOL Gain 1424 640 R0
SYMATTR InstName X9
SYMATTR SpiceLine K=1
SYMBOL Gain 544 560 R0
SYMATTR InstName X10
SYMATTR SpiceLine K=1
SYMBOL Gain 544 656 R0
SYMATTR InstName X11
SYMATTR SpiceLine K=1
SYMBOL Gain 624 480 R0
WINDOW 39 0 0 Left 0
SYMATTR SpiceLine K={Ki}
SYMATTR InstName X12
SYMBOL Gain 624 384 R0
WINDOW 39 0 0 Left 0
SYMATTR SpiceLine K={Kp}
SYMATTR InstName X13
SYMBOL Gain 608 736 R0
SYMATTR InstName X14
SYMATTR SpiceLine K={Kp}
SYMBOL Gain 608 816 R0
WINDOW 39 0 0 Left 0
SYMATTR SpiceLine K={Ki}
SYMATTR InstName X15
SYMBOL Integral 704 816 R0
SYMATTR InstName X16
SYMBOL Integral 736 480 R0
SYMATTR InstName X17
SYMBOL Adder 832 480 R0
SYMATTR InstName X18
SYMBOL Adder 816 816 R0
SYMATTR InstName X19
SYMBOL diode 208 96 R180
WINDOW 0 -4 60 Left 2
WINDOW 3 -16 0 Left 2
SYMATTR InstName D1
SYMATTR Value ideal_D
SYMBOL diode 352 96 R180
WINDOW 0 -4 63 Left 2
WINDOW 3 -17 4 Left 2
SYMATTR InstName D2
SYMATTR Value ideal_D
SYMBOL diode 496 96 R180
WINDOW 0 -4 43 Left 2
WINDOW 3 -22 4 Left 2
SYMATTR InstName D3
SYMATTR Value ideal_D
SYMBOL diode 496 352 R180
WINDOW 0 5 59 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value ideal_D
SYMBOL diode 352 352 R180
WINDOW 0 4 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMATTR Value ideal_D
SYMBOL diode 208 352 R180
WINDOW 0 -1 62 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMATTR Value ideal_D
SYMBOL DQ\ to\ ABC 1248 544 R0
SYMATTR InstName U4
SYMBOL step 192 688 R0
SYMATTR InstName U5
SYMATTR Value A=0
SYMBOL step 192 512 R0
SYMATTR InstName U6
SYMATTR Value A=2
SYMBOL ABC\ to\ DQ 192 976 R0
SYMATTR InstName U7
SYMBOL ABC\ to\ DQ 192 800 R0
SYMATTR InstName U8
SYMBOL voltage 1376 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -54 111 Left 2
SYMATTR Value SINE(0 155 50 0 0 120)
SYMATTR InstName V6
SYMBOL voltage 1456 208 R0
WINDOW 3 -213 135 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value SINE(0 155 50 0 0 240)
SYMATTR InstName V7
SYMBOL voltage 1536 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -45 90 Left 2
SYMATTR Value SINE(0 155 50 0 0 0)
SYMATTR InstName V9
SYMBOL CT 992 144 R0
SYMATTR InstName U2
SYMBOL CT 1056 192 R0
SYMATTR InstName U3
SYMBOL CT 1120 224 R0
SYMATTR InstName U9
SYMBOL PWM2 1712 480 R0
SYMATTR InstName X20
SYMBOL PWM2 1712 592 R0
SYMATTR InstName X21
SYMBOL PWM2 1712 704 R0
SYMATTR InstName X22
SYMBOL sw 144 16 R0
SYMATTR InstName S1
SYMATTR Value S1
SYMBOL sw 288 16 R0
SYMATTR InstName S2
SYMATTR Value S2
SYMBOL sw 432 16 R0
SYMATTR InstName S3
SYMATTR Value S3
SYMBOL sw 432 240 R0
SYMATTR InstName S4
SYMATTR Value S4
SYMBOL sw 288 240 R0
SYMATTR InstName S5
SYMATTR Value S5
SYMBOL sw 144 240 R0
SYMATTR InstName S6
SYMATTR Value S6
SYMBOL PLL -32 656 R0
SYMATTR InstName U10
TEXT 528 -24 Left 2 !.model ideal_D D(Ron=1m Roff=10Meg)
TEXT 1216 72 Left 2 !.tran 80m
TEXT 520 560 Left 2 ;K
TEXT 520 656 Left 2 ;K
TEXT 1400 480 Left 2 ;K
TEXT 1400 560 Left 2 ;K
TEXT 1400 640 Left 2 ;K
TEXT 600 384 Left 2 ;K
TEXT 600 480 Left 2 ;K
TEXT 584 736 Left 2 ;K
TEXT 584 816 Left 2 ;K
TEXT 1192 784 Left 2 !.param Ki=0.1\n.param Kp=1
TEXT 1624 776 Left 2 !.param Fs=8k
TEXT -480 400 Left 2 !.model S1 SW(Ron=1n Roff=1Meg) Vt=0.5 Vh=0.2\n\n.model S2 SW(Ron=1n Roff=1Meg) Vt=0.5 Vh=0.2\n\n.model S3 SW(Ron=1n Roff=1Meg) Vt=0.5 Vh=0.2\n\n.model S4 SW(Ron=1n Roff=1Meg) Vt=0.5 Vh=0.2\n\n.model S5 SW(Ron=1n Roff=1Meg) Vt=0.5 Vh=0.2\n\n.model S6 SW(Ron=1n Roff=1Meg) Vt=0.5 Vh=0.2
